<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
    <title>ElasticSearch基础 | TaoLiu-Blog</title>
    
    
        <meta name="keywords" content="ElasticSearch">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Elasticsearch是什么？ Elasticsearch 是用 Java开发 的当前 最流行 的 开源 的企业级搜索引擎,能够达到 实时搜索, 稳定, 可靠, 快速,安装使用方便。   和Solr一样的,Elasticsearch 是基于 Lucene 进行了封装, 提供了更为便利的访问和调用, Lucene可被认为是迄今为止最先进、性能最好、功能最全的搜索引擎框架。  ES与Solr对比：">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch基础">
<meta property="og:url" content="http://example.com/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="TaoLiu-Blog">
<meta property="og:description" content="Elasticsearch是什么？ Elasticsearch 是用 Java开发 的当前 最流行 的 开源 的企业级搜索引擎,能够达到 实时搜索, 稳定, 可靠, 快速,安装使用方便。   和Solr一样的,Elasticsearch 是基于 Lucene 进行了封装, 提供了更为便利的访问和调用, Lucene可被认为是迄今为止最先进、性能最好、功能最全的搜索引擎框架。  ES与Solr对比：">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/assets/png/ElasticSearch/%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99.png">
<meta property="og:image" content="http://example.com/assets/png/ElasticSearch/DSL%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2.png">
<meta property="og:image" content="http://example.com/assets/png/ElasticSearch/%E6%96%87%E6%A1%A3%E5%86%99%E5%85%A5%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="http://example.com/assets/png/ElasticSearch/%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="http://example.com/assets/png/ElasticSearch/%E5%87%86%E5%AE%9E%E6%97%B6%E7%B4%A2%E5%BC%95.png">
<meta property="article:published_time" content="2022-01-02T02:08:20.000Z">
<meta property="article:modified_time" content="2022-05-24T07:16:41.718Z">
<meta property="article:author" content="Tao Liu">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/assets/png/ElasticSearch/%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99.png">
    

    
        <link rel="alternate" href="/atom.xml" title="TaoLiu-Blog" type="application/atom+xml">
    

    
        <link rel="icon" href="/favicon.ico">
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
<script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
<meta name="generator" content="Hexo 5.4.2"></head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">TaoLiu-Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Cloud
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Redis
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/Cloud/Redis/Redis%E5%9F%BA%E7%A1%80/">Redis基础</a></li>  <li class="file"><a href="/blog/Cloud/Redis/Redis%E5%AE%89%E8%A3%85/">Redis安装</a></li>  <li class="file"><a href="/blog/Cloud/Redis/Redis%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/">Redis集群架构</a></li>  <li class="file"><a href="/blog/Cloud/Redis/Redis%E5%AE%9E%E8%B7%B5-Java/">Redis实践-Java</a></li>  <li class="file"><a href="/blog/Cloud/Redis/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0/">Redis分布式锁实现</a></li>  <li class="file"><a href="/blog/Cloud/Redis/Redis%E7%BC%93%E5%AD%98%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">Redis缓存及性能优化</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            SpringCloud
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud/">SpringCloud介绍</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%971-%E7%88%B6%E5%AD%90(%E8%81%9A%E5%90%88)%E9%A1%B9%E7%9B%AE/">SpringCloud系列1-父子(聚合)项目</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%972-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/">SpringCloud系列2-服务注册中心</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%973-%E6%B3%A8%E5%86%8C%E6%95%B0%E6%8D%AE%E5%BE%AE%E6%9C%8D%E5%8A%A1/">SpringCloud系列3-注册数据微服务</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%974-%E8%A7%86%E5%9B%BE%E5%BE%AE%E6%9C%8D%E5%8A%A1-RIBBON/">SpringCloud系列4-视图微服务-RIBBON</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%975-%E8%A7%86%E5%9B%BE%E5%BE%AE%E6%9C%8D%E5%8A%A1-Feign/">SpringCloud系列5-视图微服务-Feign</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%976-%E6%9C%8D%E5%8A%A1%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/">SpringCloud系列6-服务链路追踪</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%977-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8/">SpringCloud系列7-配置服务器</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%978-%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF/">SpringCloud系列8-配置客户端</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%979-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BFBus/">SpringCloud系列9-消息总线Bus</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%9710-%E6%96%AD%E8%B7%AF%E5%99%A8Hystrix/">SpringCloud系列10-断路器Hystrix</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%9711-%E6%96%AD%E8%B7%AF%E5%99%A8%E7%9B%91%E6%8E%A7/">SpringCloud系列11-断路器监控</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%9712-%E6%96%AD%E8%B7%AF%E5%99%A8%E8%81%9A%E5%90%88%E7%9B%91%E6%8E%A7/">SpringCloud系列12-断路器聚合监控</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%9713-%E7%BD%91%E5%85%B3Zuul/">SpringCloud系列13-网关Zuul</a></li>  <li class="file"><a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%9714-%E6%80%BB%E7%BB%93/">SpringCloud系列14-总结</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/blog/Cloud/Gateway%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Gateway源码分析</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Spring
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            SpringBoot
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/Spring/SpringBoot/SpringBoot%20Jar%E5%8C%85%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/">SpringBoot Jar包启动原理</a></li>  <li class="file"><a href="/blog/Spring/SpringBoot/SpringBoot%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD/">SpringBoot资源加载</a></li>  <li class="file"><a href="/blog/Spring/SpringBoot/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/">SpringBoot自动装配原理</a></li>  <li class="file"><a href="/blog/Spring/SpringBoot/SpringBoot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/">SpringBoot启动原理</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/blog/Spring/AOP%E5%88%87%E9%9D%A2%E7%B1%BB%E8%A7%A3%E6%9E%90/">AOP切面类解析</a></li>  <li class="file"><a href="/blog/Spring/AOP%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E4%B8%8E%E8%B0%83%E7%94%A8/">AOP创建代理与调用</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Test
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/Test/IT%E6%B5%8B%E8%AF%95%E6%80%BB%E7%BB%93/">IT测试总结</a></li>  <li class="file"><a href="/blog/Test/UT%E6%B5%8B%E8%AF%95%E6%80%BB%E7%BB%93/">UT测试总结</a></li>  <li class="file"><a href="/blog/Test/JMeter%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/">JMeter日常总结</a></li>  <li class="file"><a href="/blog/Test/LoadRunner%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/">LoadRunner日常总结</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            工具和中间件
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            搜索引擎技术
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            ElasticSearch
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file active"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E5%9F%BA%E7%A1%80/">ElasticSearch基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E5%AE%9E%E6%88%98/">ElasticSearch实战</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E8%BF%9B%E9%98%B6/">ElasticSearch进阶</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E5%B7%A5%E5%85%B7-Kibana/">ElasticSearch工具-Kibana</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch-Springboot/">ElasticSearch-Springboot</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Lucene
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Lucene/Lucene%E5%9F%BA%E7%A1%80/">Lucene基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Lucene/Lucene%E5%88%86%E8%AF%8D%E5%99%A8/">Lucene分词器</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Lucene/Lucene%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/">Lucene分页查询</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Lucene/Lucene%E7%B4%A2%E5%BC%95%E5%88%A0%E9%99%A4%E5%92%8C%E6%9B%B4%E6%96%B0/">Lucene索引删除和更新</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Solr
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E5%9F%BA%E7%A1%80/">Solr基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8IKAnalyzer/">Solr中文分词器IKAnalyzer</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E8%AE%BE%E7%BD%AE%E5%AD%97%E6%AE%B5/">Solr设置字段</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95/">Solr创建索引</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2-Solrj/">Solr分页查询-Solrj</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA/">Solr高亮显示</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/Solr/Solr%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95/">Solr更新和删除索引</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            消息队列
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Activemq
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/Activemq/ActiveMQ-%E5%9F%BA%E7%A1%80/">ActiveMQ-基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/Activemq/ActiveMQ-%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8F/">ActiveMQ-队列模式</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/Activemq/ActiveMQ-%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%BC%8F/">ActiveMQ-主题模式</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/Activemq/ActiveMQ-Spring%E9%9B%86%E6%88%90/">ActiveMQ-Spring集成</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Kafka
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/Kafka/Kafka-%E5%9F%BA%E7%A1%80/">Kafka-基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/Kafka/Kafka-Spring%E9%9B%86%E6%88%90/">Kafka-Spring集成</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            RabbitMQ
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ-%E5%9F%BA%E7%A1%80/">RabbitMQ-基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ-fanout%E6%A8%A1%E5%BC%8F/">RabbitMQ-fanout模式</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ-direct%E6%A8%A1%E5%BC%8F/">RabbitMQ-direct模式</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ-topic%E6%A8%A1%E5%BC%8F/">RabbitMQ-topic模式</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/">RabbitMQ-高级特性</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/RabbitMQ-Spring%E9%9B%86%E6%88%90/">RabbitMQ-Spring集成</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            RocketMQ
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-%E5%9F%BA%E7%A1%80/">RocketMQ-基础</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-%E7%94%9F%E4%BA%A7%E8%80%85%E6%BA%90%E7%A0%81/">RocketMQ-生产者源码</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-%E6%B6%88%E8%B4%B9%E8%80%85%E6%BA%90%E7%A0%81/">RocketMQ-消费者源码</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E6%BA%90%E7%A0%81/">RocketMQ-消息存储源码</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/">RocketMQ-高级特性</a></li>  <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-Spring%E9%9B%86%E6%88%90/">RocketMQ-Spring集成</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            数据结构和算法
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/JAVA%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">JAVA数据结构和算法</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            设计模式
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            创建型模式
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">单例模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/">原型模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/">工厂模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/">建造者模式</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            结构型模式
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/">外观模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/">代理模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/">组合模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/">装饰模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">适配器模式</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            行为型模式
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/">命令模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/">备忘录模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/">模板方法模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/">状态模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/">中介者模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">策略模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">观察者模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/">责任链模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/">访问者模式</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/">迭代器模式</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%A7%88/">设计模式概览</a></li>  <li class="file"><a href="/blog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/SOLID%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99/">SOLID基本原则</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/blog/hello-hexo/">Hello hexo</a></li>  <li class="file"><a href="/blog/index/">Welcome TaoLiu's Blog</a></li>  </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-工具和中间件/搜索引擎技术/ElasticSearch/ElasticSearch基础" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/">工具和中间件</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/">搜索引擎技术</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/">ElasticSearch</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E5%9F%BA%E7%A1%80/">
            <time datetime="2022-01-02T02:08:20.000Z" itemprop="datePublished">2022-01-02</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            ElasticSearch基础
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h2 id="Elasticsearch是什么？"><a href="#Elasticsearch是什么？" class="headerlink" title="Elasticsearch是什么？"></a>Elasticsearch是什么？</h2><ul>
<li><strong><code>Elasticsearch</code></strong> 是用 <strong>Java<code>开发</code></strong> 的当前 <strong>最流行</strong> 的 <strong>开源</strong> 的企业级搜索引擎,能够达到 <strong>实时搜索</strong>, <strong>稳定</strong>, <strong>可靠</strong>, <strong>快速</strong>,安装使用方便。  </li>
<li>和<code>Solr</code>一样的,<strong><code>Elasticsearch</code></strong> 是基于 <strong><code>Lucene</code></strong> 进行了封装, 提供了更为便利的访问和调用, Lucene可被认为是迄今为止<strong>最先进</strong>、<strong>性能最好</strong>、<strong>功能最全</strong>的<strong>搜索引擎框架</strong>。</li>
</ul>
<h2 id="ES与Solr对比："><a href="#ES与Solr对比：" class="headerlink" title="ES与Solr对比："></a>ES与Solr对比：</h2><p>单纯对<strong>已有数据</strong>进行搜索时 <strong><code>Solr</code>更快</strong>,当<strong>实时建立索引</strong>时Solr会产生 <strong><code>IO</code>阻塞</strong>,查询性能较差,该情况下  <strong><code>Elasticsearch</code></strong> 具有明显优势。</p>
<ul>
<li><strong><code>Solr</code>利用<code>Zookeeper</code>进行分布式管理</strong>,而 <strong><code>Elasticsearch</code>自带分布式协调管理</strong>功能</li>
<li><strong><code>Solr</code>支持更多格式数据</strong>,如JSON、XML、CSV,而 <strong><code>Elasticsearch</code>仅支持<code>JSON</code>文件格式</strong></li>
<li>Solr在<strong>传统搜索应用</strong>中表现好于Elasticsearch,但在处理<strong>实时搜索应用</strong>时效率明显低于Elasticsearch</li>
<li>Solr是传统搜索应用的有力解决方案,但Elasticsearch更适用于<strong>新兴实时搜索</strong>应用。</li>
</ul>
<h2 id="ES与关系型数据库"><a href="#ES与关系型数据库" class="headerlink" title="ES与关系型数据库:"></a>ES与关系型数据库:</h2><table>
    <thead>
        <tr>
            <th>关系型数据库</th>
            <th>Database数据库</th>
            <th>Table表</th>
            <th>ROW行</th>
            <th>Column列</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Elasticsearch</strong></td>
            <td><strong>Index索引库</strong></td>
            <td><strong>Type类型</strong></td>
            <td><strong>Document文档</strong></td>
            <td><strong>Field字段</strong></td>
        </tr>
    </tbody>
</table>

<h2 id="ES核心概念"><a href="#ES核心概念" class="headerlink" title="ES核心概念:"></a>ES核心概念:</h2><ul>
<li>索引index:<br>一个索引就是一个拥有几分相似特征的<strong>文档集合</strong>,相当于关系型数据库中的database,一个索引由一个名字来标识, <strong>必须全部是小写字母</strong>,且当要对对应于该索引中的文档进行索引<strong>搜索</strong>、<strong>更新</strong>和<strong>删除</strong>时,都要使用该名字。</li>
<li>Mapping映射:<br>ElasticSearch中的<strong>Mapping映射用来定义一个文档</strong>,Mapping是<strong>处理数据的方式</strong>和<strong>规则</strong>方面做一些限制,如某个<strong>字段</strong>的<strong>数据类型</strong>、<strong>默认值</strong>、<strong>分词器</strong>、<strong>是否被索引</strong>等,这都是映射里面可设置的。</li>
<li>Field字段:<br>相当于是数据表的字段或列。</li>
<li>Type字段类型：<br><strong>每个字段</strong>都应该有一个对应的<strong>类型</strong>,如 <strong><code>Text</code><strong>、</strong><code>Keyword</code><strong>、</strong><code>Byte</code></strong> 等。</li>
<li>Document文档：<br>一个文档是一个<strong>可被索引的基础信息单元</strong>,类似一条记录, <strong>文档以<code>JSON</code>格式来表示</strong>。</li>
<li>Cluster集群：<br>一个集群由<strong>一个</strong>或<strong>多个</strong>节点组织在一起, <strong>共同持有整个数据</strong>,并<strong>一起提供索引和搜索功能</strong></li>
<li>Node节点：<br>一个节点即集群中一个服务器,作为集群的一部分,它存储数据,参与集群的索引和搜索功能,一个节点<strong>可通过配置集群名称的方式来加入一个指定的集群</strong>。默认每个节点都会被安排加入到一个叫做 <strong><code>elasticsearch</code><strong>的集群中。<br><strong>一个集群中可拥有任意多个节点</strong>,且若当前网络中没有运行任何</strong><code>Elasticsearch</code><strong>节点,这时启动一个节点,会默认</strong>创建并加入</strong>一个叫做 <strong><code>elasticsearch</code></strong> 的集群。</li>
<li>分片：<br><strong>一个索引</strong>可存储<strong>超出单个结点硬件限制</strong>的大量数据,如一个具有10亿文档的索引占据1TB磁盘空间,而任一节点都没有这样大的磁盘空间,或者单个节点处理搜索请求,响应太慢,为了解决这个问题,Elasticsearch提供了将索引划分成多份的能力,每一份就是一个分片。<br>当<strong>创建索引时可指定分片数量</strong>, <strong>每个分片</strong>本身也是一个<strong>功能完善且独立的索引</strong>,该分片可被放置到集群中任何节点上, <strong>分片允许水平分割扩展内容容量</strong>,允许在分片之上进行<strong>分布式</strong>并行操作,进而提高<strong>性能</strong>和<strong>吞吐量</strong>,每个<strong>分片怎样分布</strong>, <strong>文档怎样聚合</strong>回搜索请求,完全<strong>由<code>Elasticsearch</code>管理</strong>,对于用户透明</li>
<li>副本：<br>在一个网络环境中,失败随时都可能发生,在某个分片或节点处于离线状态,或由于任何原因消失,该情况下有一个<strong>故障转移机制</strong>是非常有用且强烈推荐。为此 <strong><code>Elasticsearch</code>允许创建分片的一份或多份拷贝</strong>,这些拷贝叫做<strong>副本分片</strong>或直接叫<strong>副本</strong>。<br>扩展搜索量和吞吐量,搜索可在所有的副本上并行运行, <strong>每个索引可被分成多个分片</strong>, <strong>一个索引有零个或者多个副本</strong>, 一旦设置了副本,每个索引就有了<strong>主分片</strong>和<strong>副本分片</strong>, <strong>分片和副本数量可在索引创建时指定</strong>,在索引创建后, <strong>可在任何时候动态地改变副本数量</strong>,但<strong>不能改变分片数量</strong>。</li>
</ul>
<h1 id="ES安装"><a href="#ES安装" class="headerlink" title="ES安装"></a>ES安装</h1><p><strong>注：</strong> ES不能使用root用户来启动,必须使用普通用户来安装启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">groupadd elasticsearch # 创建elasticsearch用户组</span><br><span class="line">useradd eleven # 创建eleven用户</span><br><span class="line">passwd eleven  # 给eleven用户设置密码为eleven</span><br><span class="line">usermod -G elasticsearch eleven # 将用户eleven添加到elasticsearch用户组</span><br><span class="line"></span><br><span class="line">mkdir -p /usr/local/es # 创建es文件夹</span><br><span class="line">chown -R eleven /usr/local/es/elasticsearch-7.6.1 # 修改owner为eleven用户</span><br><span class="line"></span><br><span class="line">visudo # 使用root用户执行visudo命令然后为es用户添加权限</span><br><span class="line">eleven ALL=(ALL) ALL # 在root ALL=(ALL) ALL 一行下面添加eleven用户</span><br></pre></td></tr></table></figure>

<p>修改elasticsearch.yml,可通过修改jvm.options配置文件调整JVM参数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: eleven-es	# 集群名称</span><br><span class="line">node.name: node1	# 节点名称</span><br><span class="line">path.data: /usr/local/es/elasticsearch-7.6.1/data # 数据目录</span><br><span class="line">path.logs: /usr/local/es/elasticsearch-7.6.1/log  # 日志目录</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">discovery.seed_hosts: [&quot;IP1&quot;, &quot;IP2&quot;, &quot;IP3&quot;]</span><br><span class="line">cluster.initial_master_nodes: [&quot;节点1名称&quot;, &quot;节点2名称&quot;, &quot;节点3名称&quot;]</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>


<p>ES需要大量创建索引文件,需要大量打开系统文件,所以需要解除linux系统当中打开文件最大数目限制,不然ES启动会抛错：<span style="color: red">max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536]</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/security/limits.conf</span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 2048</span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure>
<p>若出现<span style="color: red">max number of threads [1024] for user [es] likely too low, increase to at least [4096]</span> 错误信息,是由于<strong>普通用户启动线程数限制最大可创建线程数太小</strong>,无法创建本地线程问题。</p>
<h2 id="安装IK分词器"><a href="#安装IK分词器" class="headerlink" title="安装IK分词器"></a>安装IK分词器</h2><p>使用ElasticSearch来进行<strong>中文分词</strong>,需要单独给Elasticsearch安装IK分词器插件,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/es/elasticsearch-7.6.1/plugins/ik</span><br><span class="line">cd /usr/local/es/elasticsearch-7.6.1/plugins/ik</span><br><span class="line">unzip elasticsearch-analysis-ik-7.6.1.zip</span><br></pre></td></tr></table></figure>
<p>ES的默认分词设置是 <strong><code>standard</code>单字拆分</strong>,可使用 <strong>IK分词器</strong> 的 <strong><code>ik_smart</code></strong> 和 <strong><code>ik_max_word</code></strong> 分词方式, <strong><code>ik_smart</code></strong> 会做 <strong>最粗粒度拆分</strong>, <strong><code>ik_max_word</code><strong>会将文本做</strong>最细粒度拆分</strong>。修改默认分词方法,修改 <strong><code>eleven_index</code>索引</strong>的默认分词为 <strong><code>ik_max_word</code></strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PUT /school_index</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;analysis.analyzer.default.type&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">    &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;中华人民共和国&quot;</span><br><span class="line">&#125;</span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">    &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;中华人民共和国&quot;</span><br><span class="line">&#125;</span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">    &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;中华人民共和国&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="ES基础"><a href="#ES基础" class="headerlink" title="ES基础"></a>ES基础</h2><p>ES是<strong>面向文档<code>Document</code><strong>的, <strong>使用<code>JSON</code>作为文档序列化格式</strong>,这其</strong>可存储整个对象或文档<code>Document</code></strong>,不仅仅是存储,还会<strong>索引<code>index</code>每个文档内容使之可被搜索</strong>。ES中可对<strong>文档而非成行成列的数据进行索引</strong>、<strong>搜索</strong>、<strong>排序</strong>、<strong>过滤</strong>。</p>
<p><strong>条件查询</strong>：<br><strong><code>GET /索引名称/类型/_search?q=字段1:字段值,字段2:字段值</code></strong>,条件之间是通过<strong>逗号分隔多个条件</strong>,如<strong>分页</strong>、<strong>排序</strong>、<strong>输出指定字段</strong>等通过 <strong><code>&amp;</code>符号分隔</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/nodes?v	// 查看集群节点状态</span><br><span class="line">GET _cat/health?v	// 查看集群健康状态</span><br><span class="line"></span><br><span class="line">GET /es_db 		// 查询索引：GET /索引名称</span><br><span class="line">PUT /es_db		// 创建索引：PUT /索引名称</span><br><span class="line">DELETE /es_db	// 删除索引：DELETE /索引名称</span><br><span class="line">PUT /es_db/_doc/1 	// 添加文档：PUT /索引名称/类型/id</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;张三&quot;,</span><br><span class="line">  &quot;sex&quot;: 1,</span><br><span class="line">  &quot;age&quot;: 25,</span><br><span class="line">  &quot;address&quot;: &quot;广州天河公园&quot;,</span><br><span class="line">  &quot;remark&quot;: &quot;java developer&quot;</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_doc/1 	// 查询文档：GET /索引名称/类型/id</span><br><span class="line">DELETE /es_db/_doc/1	// 删除文档：DELETE /索引名称/类型/id</span><br><span class="line">GET /es_db/_doc/_search // 查询当前类型中的所有文档：GET /索引名称/类型/_search</span><br><span class="line">GET /es_db/_doc/_search?q=age:28 // 条件查询：GET /索引名称/类型/_search?q=*:***</span><br><span class="line">GET /es_db/_doc/_search?q=age[25 TO 26] // 范围查询：GET /索引名称/类型/_search?q=***[** TO **]</span><br><span class="line">GET /es_db/_doc/_mget // 根据多个ID进行批量查询：GET /索引名称/类型/_mget</span><br><span class="line">&#123;&quot;ids&quot;:[&quot;1&quot;,&quot;2&quot;]&#125;</span><br><span class="line">GET /es_db/_doc/_search?q=age:&lt;=28 // 查询小于等于：GET /索引名称/类型/_search?q=age:&lt;=**</span><br><span class="line">GET /es_db/_doc/_search?q=age:&gt;=28 // 查询大于等于：GET /索引名称/类型/_search?q=age:&gt;=**</span><br><span class="line">GET /es_db/_doc/_search?q=age[25 TO 26]&amp;from=0&amp;size=1 // 分页查询：from=*&amp;size=*</span><br><span class="line">GET /es_db/_doc/_search?_source=name,age // 对查询结果只输出某些字段：_search?_source=字段,字段</span><br><span class="line">GET /es_db/_doc/_search?q=age[25 TO 26],sex:0 // 多条件查询</span><br><span class="line">GET /es_db/_doc/_search?sort=age:desc // 对查询结果排序sort=字段:desc/asc</span><br></pre></td></tr></table></figure>



<p><strong><code>ES</code><strong>是</strong>基于<code>Restful API</code><strong>和所有客户端交互都是使用</strong><code>JSON</code>格式</strong>数据,其他所有程序语言都可使用RESTful API,通过9200端口的与ES进行通信,GET查询、PUT添加、POST修改、DELETE删除, <strong><code>POST</code><strong>和</strong><code>PUT</code><strong>都能起到</strong>创建&#x2F;更新</strong>的作用：  </p>
<ul>
<li><strong><code>PUT</code>需要对一个具体的资源进行操作</strong>,也就是要确定id才能进行<strong>更新&#x2F;创建</strong>,而 <strong><code>POST</code>可针对整个资源集合进行操作</strong>,若<strong>不写<code>id</code>则由<code>ES</code>生成一个唯一<code>id</code>进行创建新文档</strong>,过填了id则针对该id文档进行<strong>创建&#x2F;更新</strong></li>
<li><strong><code>PUT</code>会将<code>JSON</code>数据都进行替换,<code>POST</code>只会更新相同字段的值</strong></li>
<li><strong><code>PUT</code>与<code>DELETE</code>都是幂等性操作</strong>,不论操作多少次结果都一样</li>
</ul>
<h2 id="文档批量操作"><a href="#文档批量操作" class="headerlink" title="文档批量操作"></a>文档批量操作</h2><p>通过 <strong><code>_mget</code></strong> 的API来实现 <strong>批量操作多个文档</strong>,可通过 <strong><code>_id</code></strong> 批量获取 <strong>不同<code>index</code>和<code>type</code>的数据</strong>,若查询的是同一个文档可<strong>将<code>index</code>和<code>type</code>放到URL上</strong>。且可 <strong>通过<code>_source</code>指定查询字段</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">GET _mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;docs&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;_index&quot;: &quot;es_db_1&quot;,</span><br><span class="line">      &quot;_type&quot;: &quot;_doc&quot;,</span><br><span class="line">      &quot;_id&quot;: 1,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;_index&quot;: &quot;es_db&quot;,</span><br><span class="line">      &quot;_type&quot;: &quot;_doc&quot;,</span><br><span class="line">      &quot;_id&quot;: 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_doc/_mget?_source=age,name</span><br><span class="line">&#123;</span><br><span class="line">  &quot;docs&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;_id&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;_id&quot;: 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>批量</strong> 对文档进行 <strong>写操作</strong> 是通过 <strong><code>_bulk</code></strong> 的API来实现的,通过 <strong><code>_bulk</code></strong> 写操作文档,一般至少有两行参数,第一行参数为指定 <strong>操作的类型</strong> 及 <strong>操作的对象</strong> 如index、type、id,第二行参数为 <strong>操作的数据</strong>. <strong><code>actionName</code></strong> 表示 <strong>操作类型</strong>, 主要有 <strong><code>create</code><strong>、</strong><code>index</code><strong>、</strong><code>delete</code><strong>、</strong><code>update</code></strong> 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;actionName&quot;: &#123;</span><br><span class="line">    &quot;_index&quot;: &quot;indexName&quot;,</span><br><span class="line">    &quot;_type&quot;: &quot;typeName&quot;,</span><br><span class="line">    &quot;_id&quot;: &quot;id&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;field1&quot;: &quot;value1&quot;,</span><br><span class="line">  &quot;field2&quot;: &quot;value2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;actionName&quot;: &#123;</span><br><span class="line">    &quot;_index&quot;: &quot;indexName&quot;,</span><br><span class="line">    &quot;_type&quot;: &quot;typeName&quot;,</span><br><span class="line">    &quot;_id&quot;: &quot;id&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;field1&quot;: &quot;value1&quot;,</span><br><span class="line">  &quot;field2&quot;: &quot;value2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h2 id="乐观并发控制"><a href="#乐观并发控制" class="headerlink" title="乐观并发控制"></a>乐观并发控制</h2><p>在数据库领域中,有<strong>悲观并发控制</strong>和<strong>乐观并发控制</strong>两种方法来<strong>确保并发更新</strong>不丢失数据, <strong>悲观并发控制</strong>被<strong>关系型数据库</strong>广泛使用,阻塞访问资源以防止冲突；<strong>ES使用乐观并发控制</strong>,若源数据在读写当中被修改,更新将会失败。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /db_index/_doc/1?if_seq_no=1&amp;if_primary_term=1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;Jack&quot;,</span><br><span class="line">  &quot;sex&quot;: 1,</span><br><span class="line">  &quot;age&quot;: 25,</span><br><span class="line">  &quot;book&quot;: &quot;Spring Boot 入门到精通2&quot;,</span><br><span class="line">  &quot;remark&quot;: &quot;hello world2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ES老版本</strong>是使用 <strong><code>version</code><strong>字段来乐观并发控制,新版本7.x使用</strong><code>if_seq_no</code>&#x3D;文档版本号&amp;<code>if_primary_term</code>&#x3D;文档位置</strong>来乐观并发控制。  </li>
<li>每当Primary Shard发生重新分配时如 <strong>重启</strong>, <strong><code>Primary</code>选举</strong> 等, <strong><code>_primary_term</code>会递增<code>1</code></strong>, <strong><code>_primary_term</code></strong> 主要是用来 <strong>恢复数据时</strong> 处理当多个文档的 <strong><code>_seq_no</code>一样</strong> 时的冲突.  </li>
<li>如当一个shard宕机了,<code>raplica</code>需要用到最新的数据,就会根据<code>_primary_term</code>和<code>_seq_no</code>两个值来拿到最新的document。</li>
</ul>
<h2 id="文档映射"><a href="#文档映射" class="headerlink" title="文档映射"></a>文档映射</h2><p>ES中映射可以分为<strong>动态映射</strong>和<strong>静态映射</strong>,在关系数据库中,需要事先在数据库下创建数据表,并创建表字段、类型、长度、主键等,最后才能基于表插入数据。而Elasticsearch中<strong>不需要定义<code>Mapping</code>映射</strong>,在<strong>文档写入ES时</strong>,会<strong>根据文档字段自动识别类型</strong>,该机制为<strong>动态映射</strong>；也可<strong>事先定义好映射</strong>,包含文档的各<strong>字段类型</strong>、<strong>分词器</strong>等,该方式为<strong>静态映射</strong>  </p>
<ul>
<li><strong>字符串</strong>： <strong><code>string</code>类型包含<code>text</code>和<code>keyword</code></strong></li>
<li><strong><code>text</code><strong>： 该类型被用来</strong>索引长文本</strong>,创建索引前会<strong>将文本进行分词</strong>,转化为词的组合,建立索引；允许es来检索这些词, <strong>不能用来排序和聚合</strong></li>
<li><strong><code>keyword</code><strong>： 该类型</strong>不能分词</strong>,可被用来<strong>检索过滤</strong>、<strong>排序</strong>和<strong>聚合</strong>, <strong>不可用<code>text</code>进行分词模糊检索</strong></li>
<li><strong>数值型</strong>： <strong><code>long</code><strong>、</strong><code>integer</code><strong>、</strong><code>short</code><strong>、</strong><code>byte</code><strong>、</strong><code>double</code><strong>、</strong><code>float</code></strong></li>
<li><strong>日期型</strong>： <strong><code>date</code></strong></li>
<li><strong>布尔型</strong>： <strong><code>boolean</code></strong></li>
</ul>
<p><img src="/../../../../assets/png/ElasticSearch/%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99.png" alt="动态映射规则"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_mapping // 获取文档映射</span><br><span class="line">    </span><br><span class="line">PUT /es_db2 // 创建索引且设置文档映射</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">        &quot;index&quot;: true,</span><br><span class="line">        &quot;store&quot;: true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;sex&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;,</span><br><span class="line">        &quot;index&quot;: true,</span><br><span class="line">        &quot;store&quot;: true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;,</span><br><span class="line">        &quot;index&quot;: true,</span><br><span class="line">        &quot;store&quot;: true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;book&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;index&quot;: true,</span><br><span class="line">        &quot;store&quot;: true,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_smart&quot;, // 指定text类型的ik分词器</span><br><span class="line">        &quot;search_analyzer&quot;: &quot;ik_smart&quot; // 指定text类型的ik分词器</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;address&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;index&quot;: true,</span><br><span class="line">        &quot;store&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若要<strong>推倒现有的映射</strong>,得<strong>重新建立一个静态索引</strong>,然后把之前索引里的数据<strong>导入到新的索引</strong>里, <strong>删除原创建的索引</strong>, <strong>为新索引起个别名</strong>,为原索引名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex // 把之前索引里的数据导入到新的索引里</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;db_index&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;db_index_2&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">DELETE /db_index	// 删除原创建的索引</span><br><span class="line">PUT /db_index_2/_alias/db_index	// 为新索引起个别名, 为原索引名</span><br></pre></td></tr></table></figure>

<p>若要<strong>推倒现有的映射</strong>,得<strong>重新建立一个静态索引</strong>,然后把之前索引里的数据<strong>导入到新的索引</strong>里, <strong>删除原创建的索引</strong>, <strong>为新索引起个别名</strong>,为原索引名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex // 把之前索引里的数据导入到新的索引里</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;db_index&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;db_index_2&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">DELETE /db_index	// 删除原创建的索引</span><br><span class="line">PUT /db_index_2/_alias/db_index	// 为新索引起个别名, 为原索引名</span><br></pre></td></tr></table></figure>



<h2 id="DSL高级查询"><a href="#DSL高级查询" class="headerlink" title="DSL高级查询"></a>DSL高级查询</h2><p><strong><code>Domain Specific Language</code>领域专用语言</strong>,由<strong>叶子查询子句</strong>和<strong>复合查询子句</strong>两种子句组成。DSL查询语言又分为<strong>查询<code>DSL</code><strong>和</strong>过滤<code>DSL</code><strong>。ES中索引的数据都会存储一个 <strong><code>_score</code><strong>分值, <strong>分值越高就代表越匹配</strong>, <strong>查询上下文</strong>中不仅要判断查</strong>询条件与文档是否匹配</strong>,且还要关心</strong>相关度</strong>即 <strong><code>_score</code><strong>分值,需要根据分值排序；过</strong>滤器上下文</strong>中值关心<strong>查询条件与文档是否匹配</strong>,不计算 <strong><code>_score</code><strong>分值, <strong>不关心排序</strong>问题,经常使用过滤器,ES会</strong>自动缓存过滤器内容</strong>。</p>
<p><img src="/../../../../assets/png/ElasticSearch/DSL%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2.png" alt="DSL高级查询"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_doc/_search // 无查询条件是查询所有,默认查询所有,或使用match_all表示所有</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="叶子查询"><a href="#叶子查询" class="headerlink" title="叶子查询"></a>叶子查询</h2><h3 id="模糊匹配"><a href="#模糊匹配" class="headerlink" title="模糊匹配"></a>模糊匹配</h3><p><strong>模糊匹配</strong>主要是针对<strong>文本类型</strong>的字段,文本类型的字段会对<strong>内容进行分词</strong>, <strong>查询时也会对搜索条件进行分词</strong>,然后通过<strong>倒排索引</strong>查找到匹配数据,模糊匹配主要通过 <strong><code>match</code></strong> 等参数来实现  </p>
<ul>
<li><strong><code>match</code><strong>：通过</strong>match关键词模糊匹配</strong>条件内容, <strong>需指定字段名</strong>, <strong>会进行分词</strong><ul>
<li><strong><code>query</code><strong>：</strong>指定匹配的值</strong></li>
<li><strong><code>operator</code><strong>：</strong>匹配条件类型</strong><ul>
<li><strong><code>and</code><strong>：条件分词后</strong>都</strong>要匹配</li>
<li><strong><code>or</code><strong>：条件分词后</strong>有一个</strong>匹配即可,默认为or</li>
</ul>
</li>
<li><strong><code>minmum_should_match</code><strong>：指定</strong>最小匹配数量</strong></li>
</ul>
</li>
<li><strong><code>query_string</code><strong>：和match类似, <strong>可不指定字段</strong>即</strong>所有字段中搜索</strong>,范围更广泛</li>
<li><strong><code>match_phase</code><strong>：会对输入做</strong>分词</strong>,但<strong>结果中也包含所有分词</strong>,且<strong>顺序一样</strong></li>
<li><strong><code>prefix</code><strong>：</strong>前缀匹配</strong></li>
<li><strong><code>regexp</code><strong>：通过</strong>正则表达式</strong>来匹配数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;	// match会根据该字段的分词器,进行分词查询</span><br><span class="line">      &quot;address&quot;: &quot;广州&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123; // 多字段模糊匹配查询</span><br><span class="line">      &quot;query&quot;: &quot;长沙&quot;, </span><br><span class="line">      &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;] // address或name字段中匹配到“长沙”</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123; // 未指定字段条件查询query_string, 含AND与OR条件</span><br><span class="line">      &quot;query&quot;: &quot;广州 OR 长沙&quot; // 所有的字段中只要包含“广州”或“长沙”</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123; // 指定字段条件查询query_string</span><br><span class="line">      &quot;query&quot;: &quot;admin AND 长沙&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;name&quot;, &quot;address&quot;] // name或address匹配admin和长沙</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; // ES执行搜索时,默认operator为or</span><br><span class="line">    &quot;match&quot;: &#123; // remark字段包含java或developer词组,则符合搜索条件。</span><br><span class="line">      &quot;remark&quot;: &quot;java developer&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;remark&quot;: &#123; // remark字段包含java和developer词组</span><br><span class="line">        &quot;query&quot;: &quot;java developer&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;and&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;remark&quot;: &#123; // 需要remark字段中包含多个搜索词条中的一定比例</span><br><span class="line">        &quot;query&quot;: &quot;java architect assistant&quot;,</span><br><span class="line">        &quot;minimum_should_match&quot;: &quot;50%&quot; // minimum_should_match可使用百分比或固定数字</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>match_phrase</code>短语搜索</strong>,使用短语搜索时和match类似,首先<strong>对搜索条件进行分词</strong>,ES在做分词时除了将数据切分外,还会保留一个<strong>词在整个数据中的下标<code>position</code><strong>。当ES执行match phrase短语搜索时,首先</strong>将搜索条件分词</strong>,然后<strong>在倒排索引中检索数据</strong>,若<strong>搜索条件分词数据</strong>在某个document某个field出现时,则<strong>检查匹配到的单词的<code>position</code>是否连续</strong>,若<strong>不连续则匹配失败</strong>。</p>
<p>ES对match phrase短语搜索提供了 <strong><code>slop</code>参数</strong>,可实现数据在所有匹配结果中,多个单词<strong>距离越近相关度评分越高排序越靠前</strong>,若<strong>当 <code>slop</code> 移动次数使用完毕还没有匹配成功则无搜索结果</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123; // 短语搜索,搜索条件不分词</span><br><span class="line">      &quot;remark&quot;: &quot;java assistant&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;remark&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;java assistant&quot;,</span><br><span class="line">        &quot;slop&quot;: 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前缀搜索"><a href="#前缀搜索" class="headerlink" title="前缀搜索"></a>前缀搜索</h3><p>通常针对 <strong><code>keyword</code></strong> 类型字段即<strong>不分词字段</strong>, <strong><code>keyword</code><strong>类型字段数据大小写敏感, <strong>前缀搜索效率比较低</strong>,且</strong>不计算相关度分数</strong>, <strong>前缀越短效率越低</strong>。若使用前缀搜索,建议使用长前缀,因为前缀搜索需要<strong>扫描完整索引内容</strong>,所以前缀越长相对效率越高。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /test_a/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &#123;</span><br><span class="line">      &quot;f.keyword&quot;: &#123;&quot;value&quot;: &quot;Jav&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通配符搜索"><a href="#通配符搜索" class="headerlink" title="通配符搜索"></a>通配符搜索</h3><p>通配符可在<strong>倒排索引</strong>中使用,也可在 <strong><code>keyword</code><strong>类型字段中使用。</strong><code>?</code>问号匹配一个任意字符</strong>, <strong><code>*</code>星号匹配<code>0</code>到<code>n</code>个任意字符</strong>。<strong>性能也很低</strong>,也<strong>需要扫描完整索引</strong>。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /test_a/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;f.keyword&quot;: &#123; &quot;value&quot;: &quot;?e*o*&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="正则搜索"><a href="#正则搜索" class="headerlink" title="正则搜索"></a>正则搜索</h3><p>可在 <strong>倒排索引</strong> 或 <strong><code>keyword</code></strong> 类型字段中使用, <strong>性能很低需要扫描完整索引</strong>。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /test_a/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;regexp&quot;: &#123;&quot;f.keyword&quot;: &quot;[A-z].+&quot;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="搜索推荐"><a href="#搜索推荐" class="headerlink" title="搜索推荐"></a>搜索推荐</h3><p>其原理和 <strong><code>match phrase</code><strong>类似,先使</strong>用<code>match</code>匹配<code>term</code>数据</strong>即示例中的<code>java</code>,然后在指定 <strong><code>slop</code><strong>移动次数范围内</strong>前缀匹配</strong>示例数据<code>sp</code>, <strong><code>max_expansions</code><strong>是用于</strong>指定<code>prefix</code>最多匹配多少个<code>term</code></strong>,超过该数量就不再匹配了。该语法限制只有<strong>最后一个<code>term</code><strong>会执行</strong>前缀搜索</strong>。执行<strong>性能很差</strong>, <strong>最后一个<code>term</code></strong> 需要 <strong>扫描所有符合<code>slop</code>要求的倒排索引的<code>term</code></strong>. 若必须使用一定要使用参数 <strong><code>max_expansions</code></strong>.  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /test_a/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;f&quot;: &#123;&quot;query&quot;: &quot;java sp&quot;,&quot;slop&quot;: 10,&quot;max_expansions&quot;: 10&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="模糊搜索"><a href="#模糊搜索" class="headerlink" title="模糊搜索"></a>模糊搜索</h3><p>搜索时可能搜索条件文本输入错误,fuzzy技术就是用于解决错误拼写的,英文中很有效但中文中几乎无效,其中 <strong><code>fuzziness</code></strong> 代表 <strong><code>value</code>值<code>word</code>可修改多少个字母来进行拼写错误纠正</strong>,修改字母数量包含字母变更,增加或减少字母.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /test_a/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;fuzzy&quot;: &#123;</span><br><span class="line">      &quot;f&quot;: &#123;&quot;value&quot;: &quot;word&quot;,&quot;fuzziness&quot;: 2&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="精确匹配"><a href="#精确匹配" class="headerlink" title="精确匹配"></a>精确匹配</h3><ul>
<li><strong><code>term</code><strong>： <strong>单个条件相等</strong>,查询字段</strong>映射类型</strong>属于为 <strong><code>keyword</code></strong>, <strong>不会被分词</strong></li>
<li><strong><code>terms</code><strong>： 单个字段属于某个值</strong>数组</strong>内的值</li>
<li><strong><code>range</code><strong>： 字段属于某个</strong>范围</strong>内的值<ul>
<li><strong><code>gte</code>：</strong>  大于等于</li>
<li><strong><code>lte</code>：</strong>  小于等于</li>
<li><strong><code>gt</code>：</strong>  大于</li>
<li><strong><code>lt</code>：</strong>  小于</li>
<li><strong><code>now</code>：</strong>  当前时间</li>
</ul>
</li>
<li><strong><code>exists</code><strong>： 某个字段的值</strong>是否存在</strong></li>
<li><strong><code>ids</code>：</strong>  <strong>通过ID批量查询</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123; 	// term查询不会对字段进行分词查询,会采用精确匹配</span><br><span class="line">      &quot;name&quot;: &quot;admin&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;	// 范围查询</span><br><span class="line">      &quot;age&quot;: &#123;&quot;gte&quot;: 25,&quot;lte&quot;: 28&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">POST /es_db/_doc/_search // 范围、分页、输出字段、综合查询</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;	// 范围查询</span><br><span class="line">      &quot;age&quot;: &#123;&quot;gte&quot;: 25,&quot;lte&quot;: 28&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0, // 分页</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;_source&quot;: [&quot;name&quot;, &quot;age&quot;, &quot;book&quot;], // 指定输出字段</span><br><span class="line">  &quot;sort&quot;: &#123;&quot;age&quot;: &quot;desc&quot;&#125;// 排序</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h3><p><strong>组合条件查询</strong>是将<strong>叶子条件查询</strong>语句进行<strong>组合</strong>而形成的一个完整的查询条件, <strong><code>must</code><strong>、</strong><code>filter</code><strong>、</strong><code>shoud</code><strong>、</strong><code>must_not</code><strong>等</strong>子条件</strong>是通过 <strong><code>term</code><strong>、</strong><code>terms</code><strong>、</strong><code>range</code><strong>、</strong><code>ids</code><strong>、</strong><code>exists</code><strong>、</strong><code>match</code><strong>等</strong>叶子条件为参数</strong>,当<strong>只有一个搜索条件</strong>时,must等对应的是一个<strong>对象</strong>,当<strong>多个条件</strong>时,对应的是一个<strong>数组</strong>。</p>
<ul>
<li><strong><code>bool</code>：</strong> 各条件之间有 <strong><code>and</code></strong>, <strong><code>or</code></strong> 或 <strong><code>not</code></strong> 关系<ul>
<li><strong><code>must</code>：</strong> 各个条件<strong>都必须满足</strong>,即各条件是 <strong><code>and</code></strong> 关系</li>
<li><strong><code>should</code>：</strong> 各个条件<strong>有一个满足</strong>即可,即各条件是 <strong><code>or</code></strong> 关系</li>
<li><strong><code>must_not</code>：</strong> <strong>不满足所有条件</strong>,即各条件是 <strong><code>not</code></strong> 关系</li>
<li><strong><code>filter</code>：</strong> <strong>不计算相关度评分</strong>,即<strong>不计算<code>_score</code></strong>, <strong>不对结果排序</strong>,效率更高, <strong>查询结果可被缓存</strong></li>
</ul>
</li>
<li><strong><code>constant_score</code>：</strong> <strong>不计算相关度评分</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /es_db/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123; // 对数据进行过滤</span><br><span class="line">        &quot;term&quot;: &#123;&quot;age&quot;: 25&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;		</span><br><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; // 使用should+bool搜索,控制搜索条件的匹配度</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [ // 必须匹配java、developer、assistant三个词条中的至少2个</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &quot;java&quot;&#125;&#125;,</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &quot;developer&quot;&#125;&#125;,</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &quot;assistant&quot;&#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;minimum_should_match&quot;: 2	// 控制搜索条件的匹配度</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ES中执行 <strong><code>match</code>搜索</strong> 时,ES底层通常会<strong>对搜索条件进行底层转换</strong>,来实现最终的搜索结果,若不怕麻烦, <strong>尽量使用转换后的语法执行搜索</strong>, <strong>效率更高</strong>。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_search	// 转换前</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;remark&quot;:&quot;java developer&quot;&#125;&#125;&#125;</span><br><span class="line">GET /es_db/_search	// 转换后</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;should&quot;:[&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&quot;java&quot;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&#123;&quot;value&quot;:&quot;developer&quot;&#125;&#125;&#125;]&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">GET /es_db/_search	// 转换前</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;remark&quot;:&#123;&quot;query&quot;:&quot;java developer&quot;,&quot;operator&quot;:&quot;and&quot;&#125;&#125;&#125;&#125;</span><br><span class="line">GET /es_db/_search	// 转换后</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&quot;java&quot;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&#123;&quot;value&quot;:&quot;developer&quot;&#125;&#125;&#125;]&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">GET /es_db/_search	// 转换前</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;remark&quot;:&#123;&quot;query&quot;:&quot;java architect assistant&quot;,&quot;minimum_should_match&quot;:&quot;68%&quot;&#125;&#125;&#125;&#125;</span><br><span class="line">GET /es_db/_search	// 转换后</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;should&quot;:[&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&quot;java&quot;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&quot;architect&quot;&#125;&#125;,&#123;&quot;term&quot;:&#123;&quot;remark&quot;:&quot;assistant&quot;&#125;&#125;],&quot;minimum_should_match&quot;:2&#125;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="boost权重控制"><a href="#boost权重控制" class="headerlink" title="boost权重控制"></a>boost权重控制</h3><p><strong><code>boost</code>权重控制</strong>一般用于<strong>搜索时相关度排序</strong>使用,将<strong>某字段数据匹配时</strong>相关度<strong>分数增加</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [&#123;&quot;match&quot;: &#123;&quot;remark&quot;: &quot;java&quot;&#125;&#125;],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &#123;&quot;query&quot;: &quot;developer&quot;,&quot;boost&quot;: 3&#125;&#125;&#125;,</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &#123;&quot;query&quot;: &quot;architect&quot;,&quot;boost&quot;: 1&#125;&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="dis-max"><a href="#dis-max" class="headerlink" title="dis_max"></a>dis_max</h3><p><strong><code>dis_max</code></strong> 语法是直接 <strong>获取搜索多条件</strong> 中 <strong>单条件<code>query</code>相关度分数最高</strong> 的数据,以该数据做 <strong>相关度排序</strong>。<strong>基于<code>dis_max</code></strong> 实现 <strong><code>best fields</code>策略</strong> 进行 <strong>多字段搜索</strong>, <strong><code>best fields</code>策略</strong>是搜索document中<strong>某个<code>field</code></strong>, <strong>尽可能多的匹配搜索条件</strong>。与之相反的是 <strong><code>most fields</code>策略</strong> 即 <strong>尽可能多的字段匹配到搜索条件</strong> 。</p>
<p><strong><code>best fields</code>策略</strong>优点<strong>是精确匹配</strong>的数据可尽可能排列在<strong>最前端</strong>,且可通过 <strong><code>minimum_should_match</code></strong> 去除 <strong>长尾数据</strong>,避免长尾数据字段对排序结果的影响。<strong>缺点</strong>相对<strong>排序不均匀</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_search</span><br><span class="line">&#123;	</span><br><span class="line">  &quot;query&quot;: &#123; </span><br><span class="line">    &quot;dis_max&quot;: &#123; // 找name字段中rod匹配相关度分数或remark字段中java developer匹配相关度分数,哪个高就使用哪个相关度分数进行结果排序</span><br><span class="line">      &quot;queries&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;name&quot;: &quot;rod&quot;&#125;&#125;,</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &quot;java developer&quot;&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong><code>dis_max</code></strong> 是将 <strong>多个</strong> 搜索query条件中 <strong>相关度分数最高</strong> 的用于结果排序, <strong>忽略其他<code>query</code>分数</strong>,在某些情况下 <strong>需要其他query条件中相关度介入最终结果排序</strong>,此时可 <strong>使用<code>tie_breaker</code>参数来优化<code>dis_max</code>搜索</strong>。 <strong><code>tie_breaker</code></strong> 参数表示 <strong>将其他<code>query</code>搜索条件相关度分数乘以参数值再参与结果排序</strong>。若不定义 <strong><code>tie_breaker</code></strong> 参数相当于 <strong>参数值为<code>0</code></strong>,故其他query条件的相关度分数被忽略。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_search</span><br><span class="line">&#123;	</span><br><span class="line">  &quot;query&quot;: &#123; </span><br><span class="line">    &quot;dis_max&quot;: &#123; // 找name字段中rod匹配相关度分数或remark字段中java developer匹配相关度分数,哪个高就使用哪个相关度分数进行结果排序</span><br><span class="line">      &quot;queries&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;name&quot;: &quot;rod&quot;&#125;&#125;,</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &quot;java developer&quot;&#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;tie_breaker&quot;: 0.5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用<code>multi_match</code>简化<code>dis_max+tie_breaker</code></strong>,ES中相同结果搜索也可使用不同语法语句来实现。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;dis_max&quot;: &#123;</span><br><span class="line">      &quot;queries&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;name&quot;: &quot;rod&quot;&#125;&#125;,</span><br><span class="line">        &#123;&quot;match&quot;: &#123;&quot;remark&quot;: &#123;&quot;query&quot;: &quot;java assistant&quot;,&quot;boost&quot;: 2&#125;&#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;tie_breaker&quot;: 0.5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;rod java developer&quot;,</span><br><span class="line">      &quot;fields&quot;: [</span><br><span class="line">        &quot;name&quot;,</span><br><span class="line">        &quot;remark^2&quot;	// ^n代表权重,相当于&quot;boost&quot;:n</span><br><span class="line">      ],</span><br><span class="line">      &quot;type&quot;: &quot;best_fields&quot;, // 其中type常用的有best_fields和most_fields</span><br><span class="line">      &quot;tie_breaker&quot;: 0.5,</span><br><span class="line">      &quot;minimum_should_match&quot;: &quot;50%&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>cross fields</code></strong> 是一个 <strong>唯一标识</strong>,且分布在 <strong>多个<code>fields</code></strong> 中, <strong>使用该唯一标识搜索数据即<code>cross fields</code>搜索</strong>。如人名可分为姓和名,地址可分为省、市、区县、街道等。使用人名或地址来搜索document,就称为cross fields搜索。  </p>
<p>实现这种搜索,一般都是使用 <strong><code>most fields</code>搜索策略</strong>,因为这就是 <strong>多个<code>field</code></strong> 问题。 <strong><code>Cross fields</code></strong> 搜索策略是 <strong>从多个字段中搜索条件数据</strong>, <strong>默认和<code>most fields</code>搜索逻辑一致</strong> 但 <strong>计算相关度分数和<code>best fields</code>策略一致</strong>。一般若使用cross fields搜索策略,都会携带 <strong><code>operator</code></strong> 额外参数,用来标记搜索条件如何在多个字段中匹配。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /es_db/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123; // 搜索条件中java必须在name或remark字段中匹配,developer也必须在name或remark字段中匹配</span><br><span class="line">      &quot;query&quot;: &quot;java developer&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;name&quot;, &quot;remark&quot;],</span><br><span class="line">      &quot;type&quot;: &quot;cross_fields&quot;,</span><br><span class="line">      &quot;operator&quot;: &quot;and&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>most fields</code>策略</strong> 是尽可能匹配更多字段,会导致 <strong>精确搜索结果排序问题</strong> ,又因为cross fields搜索,不能使用 <strong><code>minimum_should_match</code></strong> 来去除长尾数据。故在使用 <strong><code>most fields</code></strong> 和 <strong><code>cross fields</code></strong> 策略搜索数据时,都有不同缺陷,商业项目开发中都 <strong>推荐使用<code>best fields</code>策略</strong> 实现搜索。</p>
<p>可通过 <strong><code>copy_to</code></strong> 解决 <strong><code>cross fields</code>搜索问题</strong>, <strong><code>copy_to</code></strong> 就是将 <strong>多个字段复制到一个字段</strong> 中实现一个 <strong>多字段组合</strong>,在商业项目中,也用于 <strong>解决搜索条件默认字段问题</strong>。若需要使用copy_to语法,则需要在定义 <strong><code>index</code></strong> 时手工指定 <strong><code>mapping</code>映射策略</strong>。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /es_db/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;: &#123;</span><br><span class="line">    &quot;provice&quot;: &#123;&quot;type&quot;: &quot;text&quot;,&quot;analyzer&quot;: &quot;standard&quot;,&quot;copy_to&quot;: &quot;address&quot;&#125;,</span><br><span class="line">    &quot;city&quot;: &#123;&quot;type&quot;: &quot;text&quot;,&quot;copy_to&quot;: &quot;address&quot;&#125;,</span><br><span class="line">    &quot;street&quot;: &#123;&quot;type&quot;: &quot;text&quot;,&quot;analyzer&quot;: &quot;standard&quot;,&quot;copy_to&quot;: &quot;address&quot;&#125;,</span><br><span class="line">    &quot;address&quot;: &#123;&quot;type&quot;: &quot;text&quot;,&quot;analyzer&quot;: &quot;standard&quot;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在mapping定义中新增provice、city、street、address等字段,其中provice、city、street三个字段值会自动复制到address字段中,实现一个字段组合。在搜索地址时可在address字段中做条件匹配,从而<strong>避免<code>most fields</code>策略导致的问题</strong>。在维护数据时不需对address字段特殊维护,ES会<strong>自动维护组合字段</strong>。在存储时<strong>物理上不一定存在但逻辑上存在</strong>,因为address由3个物理存在属性province、city、street组成。</p>
<p>使用 <strong><code>match</code></strong> 和 <strong><code>proximity search</code></strong> 实现 <strong>召回率</strong> 和 <strong>精准度平衡</strong> ,若搜索时只使用<code>match phrase</code>语法,会导致 <strong>召回率低下</strong>,若只使用<code>match</code>语法,会导致 <strong>精准度低下</strong>,因为搜索结果排序是根据相关度分数算法计算得到。若需要在结果中 <strong>兼顾召回率</strong> 和 <strong>精准度</strong>,就需要将 <strong><code>match</code></strong> 和 <strong><code>proximity search</code></strong> 混合使用。</p>
<ul>
<li><strong>召回率</strong>：<strong>搜索结果比率</strong>,如索引A中有100个document,搜索时返回多少个document</li>
<li><strong>精准度</strong>：<strong>搜索结果准确率</strong>,如搜索条件为<code>hello java</code>,搜索结果中尽可能让短语匹配和<code>hello java</code>离的近的结果排序靠前<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST /test_a/_doc/3</span><br><span class="line">&#123;&quot;f&quot;:&quot;hello, java is very good, spark is also very good&quot;&#125;</span><br><span class="line">POST /test_a/_doc/4</span><br><span class="line">&#123;&quot;f&quot;:&quot;java and spark, development language &quot;&#125;</span><br><span class="line">POST /test_a/_doc/5</span><br><span class="line">&#123;&quot;f&quot;:&quot;Java Spark is a fast and general-purpose cluster computing system. It provides high-level APIs in Java, Scala, Python and R, and an optimized engine that supports general execution graphs.&quot;&#125;</span><br><span class="line">POST /test_a/_doc/6</span><br><span class="line">&#123;&quot;f&quot;:&quot;java spark and, development language &quot;&#125;</span><br><span class="line"></span><br><span class="line">GET /test_a/_search</span><br><span class="line">&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;f&quot;:&quot;java spark&quot;&#125;&#125;&#125;</span><br><span class="line">GET /test_a/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [&#123;&quot;match&quot;: &#123;&quot;f&quot;: &quot;java spark&quot;&#125;&#125;],</span><br><span class="line">      &quot;should&quot;: [&#123;&quot;match_phrase&quot;: &#123;&quot;f&quot;: &#123;&quot;query&quot;: &quot;java spark&quot;,&quot;slop&quot;: 50&#125;&#125;&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><ul>
<li><strong>父子</strong> 文档查询： <strong><code>parent/child</code></strong></li>
<li><strong>嵌套</strong> 文档查询： <strong><code>nested</code></strong></li>
</ul>
<h2 id="ES架构原理"><a href="#ES架构原理" class="headerlink" title="ES架构原理"></a>ES架构原理</h2><p>在ES中主要分成 <strong><code>Master</code></strong> 和 <strong><code>DataNode</code></strong> 两类节点,ES启动时会选举出一个Master节点,当某个节点启动后,使用 <strong><code>Zen Discovery</code>机制</strong> 找到集群中的其他节点并 <strong>建立连接</strong>,并 <strong>从候选主节点中选举出一个主节点</strong>。一个ES集群中只有一个Master节点,但会有 <strong><code>N</code>个<code>DataNode</code></strong> 节点,在生产环境中内存可相对小一点但机器要稳定。</p>
<ul>
<li><strong><code>Master</code><strong>：</strong>管理索引</strong>即创建、删除索引, <strong>分配分片</strong>, <strong>维护元数据</strong>, <strong>管理集群节点状态</strong>, <strong>不负责数据写入和查询</strong>,比较轻量级</li>
<li><strong><code>DataNode</code><strong>：</strong>数据写入</strong>, <strong>数据检索</strong>,大部分ES压力都在DataNode节点上</li>
</ul>
<h3 id="分片Shard"><a href="#分片Shard" class="headerlink" title="分片Shard"></a>分片Shard</h3><p>ES是一个<strong>分布式搜索引擎</strong>,索引数据也分成若干部分,分布在不同服务器节点中,分布在不同服务器节点中的索引数据,就是Shard分片。Elasticsearch会<strong>自动管理分片</strong>,若发现分片<strong>分布不均衡</strong>,会<strong>自动迁移</strong>一个索引index由多个shard分片组成, <strong>分片是分布在不同的服务器上</strong>。</p>
<h3 id="副本"><a href="#副本" class="headerlink" title="副本"></a>副本</h3><p>为了<strong>对ES分片进行容错</strong>,假设某个节点不可用,会导致整个索引库都将不可用。故需要对分片进行副本容错, <strong>每个分片都会有对应的副本</strong>。<strong>默认创建索引为<code>1</code>个分片</strong>、每个分片有 <strong><code>1</code>个主分片</strong> 和 <strong><code>1</code>个副本分片</strong>。</p>
<p>每个分片都会有<strong>一个<code>Primary Shard</code>主分片</strong>,也会有<strong>若干个<code>Replica Shard</code>副本分片</strong>, <strong><code>Primary Shard</code>和<code>Replica Shard</code>不在同一个节点上</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT /job_idx_shard_temp // 创建指定分片数量、副本数量的索引</span><br><span class="line">&#123;</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: &#123;&quot;type&quot;: &quot;long&quot;,&quot;store&quot;: true&#125;,</span><br><span class="line">            &quot;area&quot;: &#123;&quot;type&quot;: &quot;keyword&quot;,&quot;store&quot;: true&#125;,</span><br><span class="line">            &quot;edu&quot;: &#123;&quot;type&quot;: &quot;keyword&quot;,&quot;store&quot;: true&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;number_of_shards&quot;: 3,	// 指定分片数量</span><br><span class="line">        &quot;number_of_replicas&quot;: 2	// 指定副本数量</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /_cat/indices?v	// 查看分片、主分片、副本分片</span><br></pre></td></tr></table></figure>

<h2 id="文档写入原理"><a href="#文档写入原理" class="headerlink" title="文档写入原理"></a>文档写入原理</h2><p><img src="/../../../../assets/png/ElasticSearch/%E6%96%87%E6%A1%A3%E5%86%99%E5%85%A5%E5%8E%9F%E7%90%86.png" alt="文档写入原理"></p>
<p>选择 <strong>任意一个<code>DataNode</code>发送请求</strong> 如node2,此时node2就成为一个 <strong><code>coordinating node</code>协调节点</strong>,通过协调节点 <strong>计算得到文档要写入的分片<code>shard = hash(routing) % number_of_primary_shards</code></strong>,其中 <strong><code>routing</code></strong> 是一个 <strong>可变值</strong>, <strong>默认为文档<code>_id</code></strong>,然后 <strong>协调节点会进行路由</strong>,将请求 <strong>转发</strong>给对应 <strong><code>primary shard</code>主分片</strong>所在的 <strong><code>DataNode</code></strong>,假设primary shard主分片在node1、replica shard副分片在node2,node1节点上的Primary Shard处理请求,写入数据到索引库中,并将数据同步到Replica shard副分片,Primary Shard和Replica Shard都保存好了文档则返回Client。  </p>
<h2 id="检索原理"><a href="#检索原理" class="headerlink" title="检索原理"></a>检索原理</h2><p><img src="/../../../../assets/png/ElasticSearch/%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%86.png" alt="检索原理"></p>
<p>Client发起查询请求某个 <strong><code>DataNode</code></strong> 接收到请求后,该 <strong><code>DataNode</code></strong> 就成为 <strong><code>Coordinating Node</code>协调节点</strong>, <strong>协调节点将查询请求广播到每一个数据节点</strong>,这些 <strong>数据节点</strong> 的 <strong>分片</strong> 会处理该查询请求, <strong>每个分片进行数据查询</strong>,将符合条件的数据放在一个 <strong>优先队列</strong> 中,并将这些数据的 <strong>文档<code>ID</code></strong> 、 <strong>节点信息</strong> 、 <strong>分片信息</strong> 返回给 <strong>协调节点</strong> , <strong>协调节点将所有结果进行汇总并全局排序</strong>,协调节点向包含这些 <strong>文档<code>ID</code></strong> 的 <strong>分片</strong> 发送 <strong><code>get</code>请求</strong>,对应的分片将文档数据返回给协调节点,最后协调节点将数据返回给客户端。</p>
<h2 id="准实时索引"><a href="#准实时索引" class="headerlink" title="准实时索引"></a>准实时索引</h2><p><img src="/../../../../assets/png/ElasticSearch/%E5%87%86%E5%AE%9E%E6%97%B6%E7%B4%A2%E5%BC%95.png" alt="准实时索引">  </p>
<p>当数据写入到ES分片时会 <strong>首先写入到内存中</strong>,然后通过 <strong>内存<code>buffer</code></strong> 生成一个 <strong><code>Segment</code></strong>,并刷到 <strong>文件系统缓存</strong> 中而 <strong>不是直接刷到磁盘</strong>,数据可被检索,ES中 <strong>默认<code>1</code>秒<code>refresh</code>一次</strong>。数据在 <strong>写入内存的同时</strong>,也会 <strong>记录<code>Translog</code>日志</strong>,若 <strong>在<code>refresh</code>期间出现异常</strong>,会 <strong>根据<code>Translog</code></strong> 来进行 <strong>数据恢复</strong>,等到 <strong>文件系统缓存</strong> 中的 <strong><code>Segment</code></strong> 数据 <strong>都刷到磁盘中</strong>,则 <strong>清空<code>Translog</code>文件</strong>,ES <strong>默认每隔<code>30</code>分钟</strong> 会将 <strong>文件系统缓存</strong> 的数据 <strong>刷入到磁盘</strong>. <strong><code>Segment</code>太多</strong> 时ES <strong>定期</strong> 会将多个 <strong><code>Segment</code>合并</strong> 成为大的Segment, <strong>减少索引查询时<code>IO</code>开销</strong>,此阶段ES会真正的 <strong>物理删除</strong> 之前 <strong>执行过<code>delete</code>的数据</strong>。</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/blog/%E5%B7%A5%E5%85%B7%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%8A%80%E6%9C%AF/ElasticSearch/ElasticSearch%E5%AE%9E%E6%88%98/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    ElasticSearch实战
                
            </div>
        </a>
    
    
        <a href="/blog/Cloud/SpringCloud/SpringCloud%E7%B3%BB%E5%88%9714-%E6%80%BB%E7%BB%93/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">SpringCloud系列14-总结</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            Tao Liu &copy; 2022 
            <!-- <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a> -->
            <br> Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. Theme - <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/taoliu-hub/hexo-theme-Wikitten">wikitten</a>
            <!-- 
                <br>
                <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_pv"><i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span></span>
             -->
        </div>
    </div>
</footer>

        

    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>